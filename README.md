# 出退勤打刻アプリ（PWA対応）

> This repository contains the source code for the Attendance Punch-in and Punch-out App used in training.

スマホからワンタップで出退勤を打刻し、Googleスプレッドシートに記録しつつ、管理者用LINEグループへ自動通知する勤怠管理アプリです。

## 📋 機能一覧

- ✅ **出勤打刻** - ワンタップで出勤時刻を記録
- ✅ **退勤打刻** - 勤務時間を自動計算して記録
- ✅ **課題完了報告** - 課題完了をLINEに通知
- ✅ **LINE通知** - 全ての打刻をLINEグループに自動送信
- ✅ **PWA対応** - スマホのホーム画面に追加可能
- ✅ **オフライン対応** - Service Workerによるキャッシュ

## 🚀 セットアップ手順

### 1. スプレッドシートの準備

スプレッドシートに以下の3つのシートを作成してください：

#### シート1: `研修生マスタ`
| 研修生ID | 氏名 | ステータス |
|---------|------|-----------|
| user01  | あなたの名前 | 進行中 |

#### シート2: `打刻記録`
| 日付 | 研修生ID | 氏名 | 出勤時刻 | 退勤時刻 | 勤務時間 |
|------|---------|------|---------|---------|---------|
| (ヘッダー行のみ作成) ||||||

#### シート3: `課題完了記録`
| 完了日時 | 研修生ID | 氏名 | アプリURL | 判定 |
|---------|---------|------|----------|------|
| (ヘッダー行のみ作成) |||||

### 2. LINE Messaging APIの設定

1. [LINE Developers Console](https://developers.line.biz/console/) にアクセス
2. 新しいプロバイダーとMessaging APIチャネルを作成
3. 「Messaging API設定」タブから以下を取得：
   - **チャネルアクセストークン**（長期）を発行してコピー
4. ボットを管理者用LINEグループに招待
5. グループIDを取得（今回は既に設定済み: `C5a5b36e27a78ed6cfbb74839a8a9d04e`）

### 3. Google Apps Scriptにコードを設定

1. スプレッドシートを開く
2. 「拡張機能」→「Apps Script」をクリック
3. `Code.gs` の内容をすべてコピー
4. Apps Scriptエディタに貼り付け（既存のコードは削除）
5. 以下の定数を修正：

```javascript
// LINEチャネルアクセストークン（LINE Developersから取得したものを貼り付け）
const LINE_CHANNEL_ACCESS_TOKEN = 'YOUR_LINE_CHANNEL_ACCESS_TOKEN_HERE';

// スプレッドシートID（このスクリプトが紐づいているスプレッドシートのID）
// ※ 既に正しいIDが設定されています: 1VuUKbvUEfML2n3-Y4qycdeQR8KwMUUghp9CdhPGAeNXe68GGVTKkGhnP
```

6. 💾 保存（Ctrl + S）

### 4. Webアプリとしてデプロイ

1. Apps Scriptエディタで「デプロイ」→「新しいデプロイ」をクリック
2. 「種類の選択」で⚙️アイコンをクリック→「ウェブアプリ」を選択
3. 以下の設定を行う：
   - **説明**: 出退勤打刻アプリ v1
   - **次のユーザーとして実行**: 自分
   - **アクセスできるユーザー**: 全員
4. 「デプロイ」をクリック
5. 権限の承認を求められたら「アクセスを承認」
   - Googleアカウントを選択
   - 「詳細」→「（プロジェクト名）に移動」→「許可」
6. **デプロイ完了！** 表示されたWebアプリのURLをコピー

### 5. アプリURLを設定

デプロイで取得したURLを `Code.gs` の以下の部分に設定：

```javascript
// アプリURL（デプロイ後に更新してください）
const APP_URL = 'https://script.google.com/macros/s/【ここにデプロイID】/exec';
```

再度デプロイ（「デプロイを管理」→既存のデプロイを編集→「バージョン: 新バージョン」）

### 6. 動作確認

1. デプロイされたWebアプリのURLにアクセス
2. 「🌅 出勤」ボタンをクリック
3. スプレッドシートの「打刻記録」シートに記録されることを確認
4. LINEグループに通知が届くことを確認

## 📱 PWAとしてスマホに追加

### iOS (Safari)

1. SafariでアプリURLを開く
2. 画面下部の「共有」ボタン（□↑）をタップ
3. 「ホーム画面に追加」をタップ
4. アプリ名を確認して「追加」

### Android (Chrome)

1. ChromeでアプリURLを開く
2. 画面右上のメニュー（︙）をタップ
3. 「ホーム画面に追加」または「アプリをインストール」をタップ
4. アプリ名を確認して「追加」

## 🎯 使い方

### 出勤打刻
1. アプリを開く
2. 「🌅 出勤」ボタンをタップ
3. 「出勤打刻が完了しました」と表示されればOK
4. LINEグループに通知が届きます

### 退勤打刻
1. 「🌙 退勤」ボタンをタップ
2. 勤務時間が自動計算され、スプレッドシートに記録されます
3. LINEグループに勤務時間付きで通知が届きます

### 課題完了報告
1. 「🎉 課題完了報告」ボタンをタップ
2. 確認ダイアログで「OK」
3. LINEグループに完了報告とアプリURLが送信されます

## 📂 ファイル構成

```
課題５/
├── code.gs              # GASバックエンド（すべてのロジックを含む）
├── appsscript.json      # GAS設定ファイル
├── 仕様書.md            # システム仕様書（詳細設計書）
├── デプロイ手順.md      # デプロイ手順書
└── README.md            # このファイル
```

**重要**: `code.gs` 内にHTML/CSS/JSもすべて含まれています！
- `getIndexHtml()` - フロントエンドHTML
- `getStyleCss()` - スタイルシート
- `getManifestJson()` - PWAマニフェスト
- `getServiceWorker()` - Service Worker

## 🔧 技術スタック

- **フロントエンド**: HTML5 / CSS3 / JavaScript (Vanilla)
- **バックエンド**: Google Apps Script
- **データベース**: Google Spreadsheet
- **通知**: LINE Messaging API
- **PWA**: Service Worker + Manifest

## 📝 カスタマイズ

### 研修生IDを変更する場合

`code.gs` の以下の部分を変更：

```javascript
const USER_ID = 'user01';  // 任意のIDに変更
```

スプレッドシートの「研修生マスタ」シートにも同じIDを追加してください。

### デザインを変更する場合

`code.gs` 内の `getStyleCss()` 関数の中身を編集してください。

## ❗ トラブルシューティング

### LINE通知が届かない場合
- チャネルアクセストークンが正しいか確認
- ボットがLINEグループに参加しているか確認
- グループIDが正しいか確認

### 「研修生情報が見つかりません」エラー
- スプレッドシートの「研修生マスタ」シートに `user01` が登録されているか確認
- シート名が完全に一致しているか確認（全角/半角、スペースに注意）

### 「本日の出勤記録が見つかりません」エラー
- 先に出勤打刻をしているか確認
- 日付がまたがっている場合は新たに出勤打刻が必要

### デプロイURLにアクセスできない
- デプロイ時に「アクセスできるユーザー: 全員」を選択したか確認
- 承認画面で「許可」をクリックしたか確認

## 📚 ドキュメント

- [仕様書.md](仕様書.md) - システム全体の詳細仕様
- [デプロイ手順.md](デプロイ手順.md) - デプロイの詳細手順

## 📄 ライセンス

このプロジェクトは教育目的で作成されています。自由に改変・使用してください。

## 🎉 完成おめでとうございます！

課題完了報告ボタンを押して、管理者に報告しましょう！
